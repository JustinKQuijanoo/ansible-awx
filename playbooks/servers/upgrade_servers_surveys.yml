---
# 
# Author: Justin Quijano
# TELE36058 - Software Defined Networks
# Lab 2 - Ansible Tower/AWX
  - name: Playbook to update and upgrade all servers
    vars:
      hostname: ""
    hosts: "{{ hostname }}"
    become: true
    gather_facts: false
    tasks:

      - name: Run distribution upgrade
        ansible.builtin.apt:
          upgrade: dist
          update_cache: yes

      - name: Check if a reboot is required
        ansible.builtin.stat:
          path: /var/run/reboot-required
          get_md5: no
        register: reboot_required_file

      - name: Print if reboot is required 
        ansible.builtin.debug:
         msg: Reboot required on {{ hostname }}. Please run 'reboot_servers.yml'
        when: reboot_required_file.stat.exists == true
